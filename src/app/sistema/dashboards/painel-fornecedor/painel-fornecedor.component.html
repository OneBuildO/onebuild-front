<div class="main-container">
  <div class="banner">
    <div class="welcome">
      <h1> Bem-vindo, {{ nomeUsuario }}</h1>
      <div class="motivational-message">
        <p>"{{ motivationalMessage.quote }}"</p>
        <span class="author">{{ motivationalMessage.author }}</span>
      </div>
    </div>

    <div class="dual-card">
      <div class="invite">
        <div class="title-invite">
          <img class="phone-icon" src="/assets/icones/phone-icon.svg" alt="phone icon">
          <h3>Convidar via Whatsapp</h3>
        </div>
        <div class="invite-descricao">
          <h6>Envie um convite com o link direto para clientes e fornecedores.</h6>
        </div>
        <div class="invite-button">

          <button>Convidar</button>
        </div>
      </div>

      <div class="climate">
        <div class="title-clima">
          <h3>Clima de {{ weatherData.name }} </h3>
        </div>
        <div class="temperatura">
          <img [src]="iconUrl" alt="Ícone do clima">
          <span>{{ temperature | number:'1.0-0' }} °C</span>
        </div>
        <div class="descricao">
          <h6>Vento: {{ windSpeed }} m/s, {{ weatherDescription }}</h6>
        </div>
      </div>
    </div>
  </div>

  <div class="projetos-section">
    <h3>Projetos Disponíveis em sua Região</h3>

    <div class="projetos-cards">
      <div class="projeto-card" *ngFor="let p of projetos | slice:0:4">
        <h4>{{ p.nomeProjeto }}</h4>

        <div class="projeto-meta">
          <p><span>Arquiteto Responsável:</span> {{ p.nomeArquiteto }}</p>
          <p><span>Cidade:</span> {{p.cidade}}</p>
          <p><span>Endereço:</span> {{ p.endereco }}</p>
        </div>

        <button class="botao-link" type="button" (click)="openPropostaModal(p)">
          Acessar
        </button>
      </div>
    </div>
  </div>

  <div class="tabela-container">
    <table>
      <thead>
        <tr>
          <th>Projeto</th>
          <!--<th>Projeto</th>-->
          <th>Razão Social</th>
          <th>Status da Proposta</th>
          <th>Valor</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody *ngIf="propostasPaginadas!.length > 0; else semPropostas">
        <tr *ngFor="let proposta of propostasPaginadas">
          <td>
            <div class="perfil">
              <span *ngIf="!proposta.nomeProjeto">-</span>
              <a *ngIf="proposta.nomeProjeto" class="cliente-link">
                {{ proposta.nomeProjeto }}
              </a>
            </div>
          </td>
          <!-- <td>{{ '-' }}</td> -->
          <td>{{ proposta.razaoSocial || '-' }}</td>
          <td>{{ traduzirStatusProposta(proposta.statusProposta) || '-' }}</td>
          <td>R$ {{ proposta.valorDaProposta | number:'1.2-2' }}</td>
          <td>
            <div class="acoes">
              <a href="{{ proposta.propostaUrl }}" target="_blank">
                <button class="btn-acao visualizar">
                  <img src="assets/icones/See.png" alt="Visualizar" />
                </button>
              </a>

              <button class="btn-acao download" (click)="(baixarProposta(proposta.propostaUrl, proposta.key))">
                <img src="assets/icones/download-icon.svg" alt="Baixar" />
              </button>
              <!-- <button class="btn-acao delete">
                <img src="assets/icones/Delete.png" alt="Excluir" />
              </button> -->
            </div>
          </td>
        </tr>
      </tbody>

      <!-- quando NÃO tem propostas -->
      <ng-template #semPropostas>
        <tbody>
          <tr>
            <td colspan="5" class="sem-registros" aria-live="polite">
              <div class="empty-state">
                <img class="empty-img" src="/assets/imgs/no-data.svg" alt="Sem dados" />
                <span class="empty-msg">Sem propostas no momento.</span>
              </div>
            </td>
          </tr>
        </tbody>
      </ng-template>

    </table>
  </div>


  <div class="noticias-feed">
    <h3> Notícias sobre Arquitetura e Construção Civil</h3>
    <div class="noticias-cards">
      <div class="noticia-card" *ngFor="let noticia of noticias.slice(0, 4)">
        <img [src]="noticia.imagem" alt="Imagem da notícia" />
        <div class="noticia-info">
          <h4>{{ noticia.titulo }}</h4>
          <p class="data">{{ noticia.data | date: 'dd/MM/yyyy' }}</p>
          <a [href]="noticia.link" target="_blank" class="botao-link">Notícia Completa</a>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Modal de Proposta -->
<div class="modal-overlay" *ngIf="isPropostaOpen" (click)="closePropostaModal($event)">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Enviar proposta — {{ selectedProjeto?.nomeProjeto }}</h3>
      <button class="close" (click)="isPropostaOpen=false" aria-label="Fechar">×</button>
    </div>

    <div class="modal-body">
      <ul class="projeto-attrs">
        <li><strong>Arquiteto:</strong> {{ selectedProjeto?.nomeArquiteto }}</li>
        <li><strong>Cidade:</strong> {{ selectedProjeto?.cidade }}</li>
        <li><strong>Endereço:</strong> {{ selectedProjeto?.endereco }}</li>
      </ul>

      <div class="form-field">
        <label for="valor">Valor da proposta</label>
        <input id="valor" type="number" min="0" step="0.01" placeholder="Ex: 15000.00" [(ngModel)]="propostaValor" />
      </div>

      <div class="form-field">
        <label for="arquivo">Anexar proposta (PDF/DOC)</label>
        <input id="arquivo" type="file" accept=".pdf,.doc,.docx" (change)="onFileChange($event)" />
        <small *ngIf="propostaFileName">Selecionado: {{ propostaFileName }}</small>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="isPropostaOpen=false">Cancelar</button>
      <button class="btn btn-primary" [disabled]="!propostaValor || !propostaFile" (click)="enviarProposta()">
        Enviar
      </button>
    </div>
  </div>
</div>